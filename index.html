<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- SEO Meta Tags -->
    <title>radiomore.love - Music, Fashion & Chill | #LLL Online Radio</title>
    <meta name="description" content="Tune in to our online radio for the best mix of chill music and fashion-forward vibes. All music is royalty-free, making it ideal for public playback in shops, restaurants, cafes, and other commercial spaces without licensing fees. Your perfect soundtrack for a relaxed lifestyle. #LLL Radio." />
    <meta name="keywords" content="online radio, music, fashion, chill, LLL, radio stream, lifestyle music, chillout, internet radio, streaming, royalty-free music, copyright-free, public performance, no license fees, background music, shop music, restaurant music, in-store music, cafe music, commercial background music, business music" />
    <meta name="author" content="RadioHost" />
    <link rel="canonical" href="https://radiomore.love" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://radiomore.love" />
    <meta property="og:title" content="radiomore.love - Music, Fashion & Chill | #LLL Online Radio" />
    <meta property="og:description" content="Tune in to our online radio for the best mix of chill music and fashion-forward vibes. All music is royalty-free, making it ideal for public playback in shops, restaurants, cafes, and other commercial spaces without licensing fees. Your perfect soundtrack for a relaxed lifestyle. #LLL Radio." />
    <meta property="og:image" content="https://raw.githubusercontent.com/radiohost-cloud/radiomorelove/main/logo.png" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="https://radiomore.love" />
    <meta property="twitter:title" content="radiomore.love - Music, Fashion & Chill | #LLL Online Radio" />
    <meta property="twitter:description" content="Tune in to our online radio for the best mix of chill music and fashion-forward vibes. All music is royalty-free, making it ideal for public playback in shops, restaurants, cafes, and other commercial spaces without licensing fees. Your perfect soundtrack for a relaxed lifestyle. #LLL Radio." />
    <meta property="twitter:image" content="https://raw.githubusercontent.com/radiohost-cloud/radiomorelove/main/logo.png" />

    <!-- General -->
    <link rel="icon" href="https://raw.githubusercontent.com/radiohost-cloud/radiomorelove/main/logo.png" />
    
    <!-- Web App Manifest -->
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#000000" />

    <!-- iOS specific tags -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="radiomore.love" />
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/radiohost-cloud/radiomorelove/main/logo.png" />

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  </head>
  <body class="overflow-hidden">
    <div id="root"></div>
    <script type="text/babel">
      const App = () => {
        const { useState, useEffect, useRef, useLayoutEffect } = React;
        const [isMenuOpen, setIsMenuOpen] = useState(false);
        const [isMounted, setIsMounted] = useState(false);
        const [tickerText, setTickerText] = useState('Loading latest updates...');
        const [isPopupOpen, setIsPopupOpen] = useState(false);
        const [popupTitle, setPopupTitle] = useState('');
        const [popupContent, setPopupContent] = useState('');
        const [popupIcon, setPopupIcon] = useState('');
        const [nowPlaying, setNowPlaying] = useState(null);
        const [isPlaying, setIsPlaying] = useState(false);
        const [showInstallPrompt, setShowInstallPrompt] = useState(false);
        const [deferredInstallPrompt, setDeferredInstallPrompt] = useState(null);
        const [showIosInstructions, setShowIosInstructions] = useState(false);
        const [showGenericInstructions, setShowGenericInstructions] = useState(false);
        const [isPlayerFlipped, setIsPlayerFlipped] = useState(false);
        const [showOnboarding, setShowOnboarding] = useState(false);
        const [onboardingStep, setOnboardingStep] = useState(0);
        const [isInitialOnboarding, setIsInitialOnboarding] = useState(true);
        const [isOnboardingStepFading, setIsOnboardingStepFading] = useState(false);
        
        const tickerContainerRef = useRef(null);
        const textRef = useRef(null);
        const popupContentRef = useRef(null);
        const autoCloseTimerRef = useRef(null);
        const menuClickIntentRef = useRef(false);
        const audioRef = useRef(null);
        const nowPlayingTimeoutRef = useRef(null);
        const videoRef = useRef(null);
        const installPromptTimers = useRef({ show: null, hide: null });

        const logoUrl = 'https://raw.githubusercontent.com/radiohost-cloud/radiomorelove/main/logo.png';
        const feedUrl = 'https://raw.githubusercontent.com/radiohost-cloud/radiomorelove/main/feed.txt';
        const apiUrl = 'https://stream.radiohost.cloud/api/nowplaying/live';
        const streamAudioUrl = 'https://stream.radiohost.cloud/hls/live/live.m3u8';
        const backgroundVideoUrl = 'https://raw.githubusercontent.com/radiohost-cloud/radiomorelove/main/background.mp4';

        const menuItems = [
            { 
                name: 'Home', 
                icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>',
                contentUrl: 'https://raw.githubusercontent.com/radiohost-cloud/radiomorelove/main/home.txt'
            },
            { 
                name: 'X', 
                icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg>',
                content: `<div id="curator-feed-x-layout"><a href="https://curator.io" target="_blank" class="crt-logo crt-tag">Powered by Curator.io</a></div>`
            },
            {
                name: 'Instagram',
                icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><rect width="20" height="20" x="2" y="2" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5" stroke-linecap="round"></line></svg>',
                content: `<div id="curator-feed-instagram-layout"><a href="https://curator.io" target="_blank" class="crt-logo crt-tag">Powered by Curator.io</a></div>`
            },
            { 
                name: 'YouTube', 
                icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>',
                content: `<div id="curator-feed-youtube-layout"><a href="https://curator.io" target="_blank" class="crt-logo crt-tag">Powered by Curator.io</a></div>`
            },
            { 
                name: 'App', 
                icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" /></svg>',
                content: `
                    <div class="space-y-4 text-gray-300">
                        <p class="font-semibold text-lg text-white">Listen Everywhere</p>
                        <ul class="list-none space-y-3">
                            <li class="flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3 text-blue-400 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></svg>
                                <a href="https://mytuner-radio.com/radio/radiomorelove-515889/" target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:text-blue-300 underline">
                                    Available on mytuner-radio.com
                                </a>
                            </li>
                            <li class="flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3 text-blue-400 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></svg>
                                <a href="https://www.theradioapp.com/" target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:text-blue-300 underline">
                                    The Radio App on 99.9FM
                                </a>
                            </li>
                            <li>
                                <span>
                                    To listen on the go, find 'mytuner radio' or 'The Radio App' on the Google Play and Apple App Stores!
                                </span>
                            </li>
                        </ul>
                    </div>
                `
            },
            { 
                name: 'About Us', 
                icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>',
                contentUrl: 'https://raw.githubusercontent.com/radiohost-cloud/radiomorelove/main/aboutus.txt'
            },
            { 
                name: 'Ko-fi', 
                icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" /></svg>',
                content: `
                    <div class="text-center space-y-4 py-4">
                        <p class="text-xl font-semibold">Enjoying the vibes?</p>
                        <p class="text-gray-300">Your support helps us keep the music flowing. Consider buying us a coffee! ‚ù§Ô∏è</p>
                        <a href="https://ko-fi.com/radiomorelove" target="_blank" rel="noopener noreferrer" class="inline-block bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-1">
                            Support us on Ko-fi
                        </a>
                    </div>
                `
            }
        ];
        
        const onboardingSteps = [
            { // Dummy step 0
                highlightStyle: {}, tooltipStyle: {}, title: '', text: ''
            },
            { // Step 1: Menu
                highlightStyle: { top: '1rem', left: '1rem', width: '4rem', height: '4rem', borderRadius: '50%' },
                tooltipStyle: { top: '6rem', left: '1rem' },
                title: 'Welcome to radiomore.love!',
                text: 'This is the menu button. Click it to navigate through different sections like our social feeds, info about the app, and more.'
            },
            { // Step 2: Chat
                highlightStyle: { bottom: '1rem', right: '1rem', width: '4rem', height: '4rem', borderRadius: '50%' },
                tooltipStyle: { bottom: '6rem', right: '1rem', maxWidth: '300px' },
                title: 'Talk to Our AI Assistant',
                text: 'Have a question or just want to chat? Our AI assistant is here to help you 24/7. Give it a try!'
            },
            { // Step 3: Player
                highlightStyle: { top: '50%', left: '50%', transform: 'translate(-50%, -50%)', width: 'min(90%, 20rem)', height: '26rem' },
                tooltipStyle: { top: '50%', left: '50%', transform: 'translate(-50%, -50%)', width: 'min(90%, 19rem)' },
                title: 'The Main Stage',
                text: 'This is the heart of the station. See what\'s currently playing and control your listening experience right here. Enjoy the vibes!'
            }
        ];

        const fetchNowPlaying = async () => {
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error(`NowPlaying API error! status: ${response.status}`);
                }
                const data = await response.json();
                setNowPlaying(data);

                const remaining = (data.now_playing.remaining || 0) * 1000;
                const delay = remaining > 0 ? remaining + 2000 : 15000;
                
                if (nowPlayingTimeoutRef.current) clearTimeout(nowPlayingTimeoutRef.current);
                nowPlayingTimeoutRef.current = setTimeout(fetchNowPlaying, delay);

            } catch (error) {
                console.error("Could not fetch Now Playing data:", error);
                if (nowPlayingTimeoutRef.current) clearTimeout(nowPlayingTimeoutRef.current);
                nowPlayingTimeoutRef.current = setTimeout(fetchNowPlaying, 30000);
            }
        };

        useEffect(() => {
            const hasOnboarded = localStorage.getItem('hasCompletedOnboarding');
            if (!hasOnboarded) {
                setTimeout(() => {
                    setShowOnboarding(true);
                    setOnboardingStep(1);
                }, 1500);
            }
        }, []);

        useEffect(() => {
          setIsMounted(true);

          const flipToBackTimer = setTimeout(() => {
            setIsPlayerFlipped(true);
          }, 2000);
          const flipToFrontTimer = setTimeout(() => {
            setIsPlayerFlipped(false);
          }, 7000);
          
          fetchNowPlaying();

          const openTimer = setTimeout(() => {
            setIsMenuOpen(true);
             // On mobile devices, set a timer to automatically close the menu after 5 seconds of inactivity.
            if (window.innerWidth < 768) {
                autoCloseTimerRef.current = setTimeout(() => setIsMenuOpen(false), 5000);
            }
          }, 8000);

          return () => {
            clearTimeout(openTimer);
            if (autoCloseTimerRef.current) clearTimeout(autoCloseTimerRef.current);
            if (nowPlayingTimeoutRef.current) clearTimeout(nowPlayingTimeoutRef.current);
            clearTimeout(flipToBackTimer);
            clearTimeout(flipToFrontTimer);
          };
        }, []);
        
        useEffect(() => {
            const beforeInstallHandler = (e) => {
                e.preventDefault();
                setDeferredInstallPrompt(e);
            };
            window.addEventListener('beforeinstallprompt', beforeInstallHandler);

            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const isInStandaloneMode = window.matchMedia('(display-mode: standalone)').matches;
            const hasDismissed = localStorage.getItem('installPromptDismissed') === 'true';

            if (isMobile && !isInStandaloneMode && !hasDismissed) {
                installPromptTimers.current.show = setTimeout(() => {
                    setShowInstallPrompt(true);
                    installPromptTimers.current.hide = setTimeout(() => {
                        setShowInstallPrompt(false);
                    }, 5000);
                }, 2000);
            }

            return () => {
                window.removeEventListener('beforeinstallprompt', beforeInstallHandler);
                clearTimeout(installPromptTimers.current.show);
                clearTimeout(installPromptTimers.current.hide);
            };
        }, []);

        useEffect(() => {
            const handleContextMenu = (e) => e.preventDefault();
            const handleKeyDown = (e) => {
                if (
                    e.key === 'F12' ||
                    (e.ctrlKey && e.shiftKey && ['I', 'J', 'C'].includes(e.key.toUpperCase())) ||
                    (e.metaKey && e.altKey && ['I', 'J', 'C'].includes(e.key.toUpperCase())) ||
                    (e.ctrlKey && e.key.toUpperCase() === 'U') ||
                    (e.metaKey && e.key.toUpperCase() === 'U')
                ) {
                    e.preventDefault();
                }
            };

            document.addEventListener('contextmenu', handleContextMenu);
            document.addEventListener('keydown', handleKeyDown);

            return () => {
                document.removeEventListener('contextmenu', handleContextMenu);
                document.removeEventListener('keydown', handleKeyDown);
            };
        }, []);

        useEffect(() => {
            const videoElement = videoRef.current;
            if (!videoElement) return;

            const intervalId = setInterval(() => {
                if (videoElement.paused) {
                    videoElement.play().catch(() => {});
                }
            }, 1000);

            videoElement.play().catch(() => {});

            return () => clearInterval(intervalId);
        }, []);
        
        useEffect(() => {
            const audio = audioRef.current;
            if (!audio) return;
            
            let hls;

            if (Hls.isSupported()) {
                hls = new Hls();
                hls.loadSource(streamAudioUrl);
                hls.attachMedia(audio);
                hls.on(Hls.Events.ERROR, function (event, data) {
                    if (data.fatal) {
                        console.error('HLS.js fatal error:', data);
                        switch(data.type) {
                            case Hls.ErrorTypes.NETWORK_ERROR:
                                hls.startLoad();
                                break;
                            case Hls.ErrorTypes.MEDIA_ERROR:
                                hls.recoverMediaError();
                                break;
                            default:
                                hls.destroy();
                                break;
                        }
                    }
                });
            } else if (audio.canPlayType('application/vnd.apple.mpegurl')) {
                audio.src = streamAudioUrl;
            }

            return () => {
                if (hls) {
                    hls.destroy();
                }
            };
        }, []);

        useEffect(() => {
          const fetchTickerText = async () => {
            try {
              const response = await fetch(feedUrl);
              if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
              const text = await response.text();
              setTickerText((text.trim() + '  ‚Ä¢  ').repeat(10));
            } catch (error) {
              console.error("Could not fetch ticker text:", error);
              const fallbackText = 'Welcome to #LLL Radio üéß  ‚Ä¢  Your daily dose of chill beats üéµ, fashion üï∂Ô∏è, and good vibes ‚ú®  ‚Ä¢  Tune in and relax üòå  ‚Ä¢  ';
              setTickerText(fallbackText.repeat(10));
            }
          };
          fetchTickerText();
        }, []);

        useEffect(() => {
            const handleKeyDown = (event) => {
                if (event.key === 'Escape') setIsPopupOpen(false);
            };

            const SCRIPT_ID_IG = 'curator-io-script-ig', SCRIPT_ID_X = 'curator-io-script-x', SCRIPT_ID_YT = 'curator-io-script-yt';

            if (isPopupOpen) {
                window.addEventListener('keydown', handleKeyDown);

                const createScript = (id, src) => {
                    if (document.getElementById(id)) return;
                    const script = document.createElement('script');
                    script.id = id; script.src = src; script.async = true; script.charset = "UTF-8";
                    document.body.appendChild(script);
                };

                if (popupTitle === 'Instagram') createScript(SCRIPT_ID_IG, "https://cdn.curator.io/published/42c1c4cc-219e-4927-a74b-9f7c6993aa71.js");
                if (popupTitle === 'X') createScript(SCRIPT_ID_X, "https://cdn.curator.io/published/6e7130f2-a1be-47ef-98a0-766a31718031.js");
                if (popupTitle === 'YouTube') createScript(SCRIPT_ID_YT, "https://cdn.curator.io/published/e6d7c0c6-7137-40cf-8645-5d989129622c.js");
            }

            return () => {
                window.removeEventListener('keydown', handleKeyDown);
                [SCRIPT_ID_IG, SCRIPT_ID_X, SCRIPT_ID_YT].forEach(id => document.getElementById(id)?.remove());
            };
        }, [isPopupOpen, popupTitle]);
        
        const togglePlayPause = React.useCallback(() => {
            if (!audioRef.current) return;
            if (audioRef.current.paused) {
                audioRef.current.play().catch(e => console.error("Playback error:", e));
            } else {
                audioRef.current.pause();
            }
        }, []);

        useEffect(() => {
            if (!('mediaSession' in navigator)) {
                return;
            }

            if (nowPlaying) {
                const { song } = nowPlaying.now_playing;
                navigator.mediaSession.metadata = new MediaMetadata({
                    title: song.title,
                    artist: song.artist,
                    album: 'radiomore.love',
                    artwork: [{ src: song.art }],
                });
            }
            
            navigator.mediaSession.setActionHandler('play', togglePlayPause);
            navigator.mediaSession.setActionHandler('pause', togglePlayPause);
            
            try {
                navigator.mediaSession.playbackState = isPlaying ? 'playing' : 'paused';
            } catch (error) {
                // Some browsers (like desktop Safari) throw an error here.
                console.warn('Could not set media session playback state.', error);
            }

        }, [nowPlaying, isPlaying, togglePlayPause]);

        useLayoutEffect(() => {
            if (tickerContainerRef.current && textRef.current) {
                const textWidth = textRef.current.offsetWidth;
                const pixelsPerSecond = 50;
                if (textWidth > 0 && pixelsPerSecond > 0) {
                    const duration = textWidth / pixelsPerSecond;
                    tickerContainerRef.current.style.animationDuration = `${duration}s`;
                }
            }
        }, [tickerText]);

        // Effect to handle dynamic viewport height for mobile browsers
        useEffect(() => {
            const setVh = () => {
                document.documentElement.style.setProperty('--vh', `${window.innerHeight * 0.01}px`);
            };
            setVh();
            window.addEventListener('resize', setVh);
            return () => window.removeEventListener('resize', setVh);
        }, []);
        
        const handleNextOnboardingStep = () => {
            if (onboardingStep < 3) {
                if (isInitialOnboarding) setIsInitialOnboarding(false);
                const nextStep = onboardingStep + 1;
                setIsOnboardingStepFading(true); // Fade out

                setTimeout(() => {
                    setOnboardingStep(nextStep);
                    setIsOnboardingStepFading(false); // Fade back in
                }, 500);
            } else {
                handleSkipOnboarding();
            }
        };

        const handleSkipOnboarding = () => {
            setShowOnboarding(false);
            setOnboardingStep(0);
            localStorage.setItem('hasCompletedOnboarding', 'true');
        };

        const toggleMenu = (e) => {
            e.stopPropagation();
            if (autoCloseTimerRef.current) {
              clearTimeout(autoCloseTimerRef.current);
              autoCloseTimerRef.current = null;
            }
            
            const nextIsOpen = !isMenuOpen;
            setIsMenuOpen(nextIsOpen);

            // On mobile, if we are opening the menu, set the auto-close timer.
            // On desktop, this behavior is handled by mouse enter/leave.
            if (nextIsOpen && window.innerWidth < 768) {
                autoCloseTimerRef.current = setTimeout(() => {
                    setIsMenuOpen(false);
                }, 5000);
            }
            
            // This ref is used to 'pin' the menu open on desktop after a click
            menuClickIntentRef.current = nextIsOpen;
        };

        const handleMenuItemClick = async (item) => {
            if (item.url) {
                window.open(item.url, '_blank', 'noopener,noreferrer');
                setIsMenuOpen(false);
                return;
            }

            if (autoCloseTimerRef.current) {
              clearTimeout(autoCloseTimerRef.current);
              autoCloseTimerRef.current = null;
            }
            menuClickIntentRef.current = false;
        
            setPopupTitle(item.name);
            setPopupIcon(item.icon);
            setIsPopupOpen(true);
            setIsMenuOpen(false);
        
            if (item.contentUrl) {
              setPopupContent('<p class="text-center text-gray-400">Loading...</p>');
              try {
                const response = await fetch(item.contentUrl);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const text = await response.text();
                
                const linkify = (line) => {
                    const urlPattern = /(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])|(\bwww\.[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig;
                    return line.replace(urlPattern, (url) => {
                        const fullUrl = url.startsWith('www.') ? `http://${url}` : url;
                        return `<a href="${fullUrl}" target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:text-blue-300 underline break-all">${url}</a>`;
                    });
                };

                let htmlContent = text.split('\n')
                                        .filter(line => line.trim() !== '')
                                        .map(line => `<p class="mb-2">${linkify(line)}</p>`)
                                        .join('');

                if (item.name === 'About Us') {
                    htmlContent += `<div class="border-t border-gray-700 pt-4 mt-4 text-center">
                        <p class="text-white/80 text-sm flex items-center justify-center">
                            <span>Music on air is AI-generated</span>
                            <a href="https://open.spotify.com/artist/41E9IlYbyBT0GaOwEYkGVM" target="_blank" rel="noopener noreferrer" class="text-[#1DB954] hover:text-[#1ED760] transition-colors ml-2 flex items-center justify-center" aria-label="Listen on Spotify">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor" viewBox="0 0 496 512"><path d="M248 8C111.1 8 0 119.1 0 256s111.1 248 248 248 248-111.1 248-248S384.9 8 248 8zm100.7 364.9c-2.1 3.9-6.3 5.1-10.2 2.9-33.3-19.3-74.5-23.7-124.5-12.9-4.3 .9-8.4-1.1-9.3-5.4s1.1-8.4 5.4-9.3c53.9-11.6 98.7-6.8 135.8 14.1 4.1 2.3 5.4 6.9 3.1 10.6zm13.5-44.5c-2.7 4.9-8.3 6.3-13.2 3.6-40.3-23.1-104.3-29.6-146.8-16.3-5.1 1.6-10.4-1.5-12-6.6s1.5-10.4 6.6-12c48.1-14.6 117.8-7.5 163.4 18.4 4.9 2.8 6.3 8.8 3.5 13.5zm.1-49.7c-3.2 5.9-9.8 7.8-15.7 4.6-45.4-26.4-121.2-32.2-169.4-17.8-6.1 1.8-12.2-1.8-14-7.9s1.8-12.2 7.9-14c53.6-15.8 135.8-9.5 187.1 19.8 5.9 3.2 7.8 9.9 4.6 15.8z"/></svg>
                            </a>
                        </p>
                    </div>`;
                }
                setPopupContent(htmlContent || '<p>No content available.</p>');
              } catch (error) {
                console.error("Could not fetch content:", error);
                setPopupContent('<p class="text-center text-red-500">Could not load content. Please try again later.</p>');
              }
            } else {
              setPopupContent(item.content);
            }
        };

        const handleInstallClick = async () => {
            setShowInstallPrompt(false);
            if (deferredInstallPrompt) {
                deferredInstallPrompt.prompt();
                await deferredInstallPrompt.userChoice;
                setDeferredInstallPrompt(null);
            } else {
                const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
                if (isIOS) {
                    setShowIosInstructions(true);
                } else {
                    setShowGenericInstructions(true);
                }
            }
        };

        const handleDismissInstall = () => {
            setShowInstallPrompt(false);
            localStorage.setItem('installPromptDismissed', 'true');
        };

        const menuItemsToRender = menuItems.sort((a, b) => {
          const order = ['Home', 'X', 'Instagram', 'YouTube', 'App', 'About Us', 'Ko-fi'];
          return order.indexOf(a.name) - order.indexOf(b.name);
        });

        const onboardingTransitionClass = isInitialOnboarding
          ? 'transition-all duration-700 ease-in-out'
          : 'transition-opacity duration-500 ease-in-out';

        return (
          <React.Fragment>
            <div 
              className={`relative w-screen h-screen-dynamic bg-black overflow-hidden transition-transform duration-500 ease-in-out ${showInstallPrompt ? '-translate-y-[80px]' : 'translate-y-0'}`}
              onClick={() => {
              if (isMenuOpen) {
                if (autoCloseTimerRef.current) clearTimeout(autoCloseTimerRef.current);
                autoCloseTimerRef.current = null;
                menuClickIntentRef.current = false;
                setIsMenuOpen(false);
              }
            }}>
              <video 
                ref={videoRef}
                autoPlay 
                loop 
                muted 
                playsInline
                className="absolute top-0 left-0 w-full h-full object-cover"
                src={backgroundVideoUrl}
              ></video>
              
              <div className="absolute inset-0 bg-black/50"></div>

              <header 
                  className="absolute top-4 left-4 right-4 h-16 bg-black/80 backdrop-blur-sm rounded-full flex items-center z-40 shadow-lg"
                  onMouseEnter={() => {
                      if (window.innerWidth >= 768) {
                          if (autoCloseTimerRef.current) clearTimeout(autoCloseTimerRef.current);
                          autoCloseTimerRef.current = null;
                          setIsMenuOpen(true);
                      }
                  }}
                  onMouseLeave={() => {
                      if (window.innerWidth >= 768 && !menuClickIntentRef.current) setIsMenuOpen(false);
                  }}
              >
                  <div className="flex-shrink-0 w-16 h-16 z-20">
                      <button onClick={toggleMenu} className="relative w-16 h-16 rounded-full p-0 border-0 bg-transparent cursor-pointer" aria-label="Toggle navigation menu" aria-haspopup="true" aria-expanded={isMenuOpen}>
                          <img src={logoUrl} alt="RadioHost Logo" className={`w-full h-full rounded-full object-cover transition-transform duration-300 hover:scale-110 ${isPlaying ? 'logo-spinning' : ''}`} />
                      </button>
                  </div>

                  <div className="flex-grow h-full relative overflow-hidden ticker-mask">
                      <div ref={tickerContainerRef} className="absolute top-0 left-0 h-full flex items-center animate-marquee">
                          <p ref={textRef} className="text-gray-200 text-lg whitespace-nowrap px-8">{tickerText}</p>
                          <p className="text-gray-200 text-lg whitespace-nowrap px-8" aria-hidden="true">{tickerText}</p>
                      </div>
                  </div>

                  <nav onClick={(e) => e.stopPropagation()} aria-label="Main navigation" className={`absolute ${isMenuOpen ? 'pointer-events-auto opacity-100' : 'pointer-events-none opacity-0'} ${isMounted ? 'transition-opacity duration-[1100ms]' : ''} md:opacity-100 md:pointer-events-auto top-0 left-0 w-full h-full rounded-full bg-black/90 backdrop-blur-sm z-10 md:top-full md:left-0 md:w-16 md:h-auto md:bg-transparent md:backdrop-blur-none md:z-auto md:mt-2 md:rounded-lg`}>
                      <ul className="list-none m-0 p-0 h-full flex flex-row items-center justify-around pl-20 pr-16 md:justify-start md:pl-0 md:pr-0 md:flex-col md:items-center md:gap-2 md:h-auto">
                          {menuItemsToRender.map((item, index) => (
                              <li key={item.name}>
                                  <button
                                      onClick={() => handleMenuItemClick(item)}
                                      className={`w-9 h-9 md:w-16 md:h-16 bg-black text-white rounded-full flex items-center justify-center md:shadow-lg hover:bg-white hover:text-black focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-gray-400 ${isMounted ? 'transition-all duration-500 ease-out' : ''} ${isMenuOpen ? 'opacity-100 translate-x-0 md:translate-y-0' : 'opacity-0 -translate-x-4 md:-translate-y-4'}`}
                                      style={{ transitionDelay: isMenuOpen ? `${index * 80}ms` : `${(menuItemsToRender.length - 1 - index) * 80}ms` }}
                                      tabIndex={isMenuOpen ? 0 : -1}
                                      aria-label={item.name}
                                      dangerouslySetInnerHTML={{ __html: item.icon }}
                                  ></button>
                              </li>
                          ))}
                      </ul>
                  </nav>
              </header>
              
              <audio ref={audioRef} preload="auto" onPlay={() => setIsPlaying(true)} onPause={() => setIsPlaying(false)}></audio>
              
              {nowPlaying && (
                <div className="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[90%] max-w-xs z-30 animate-fade-in-up [perspective:1000px]">
                  <div
                    className={`relative transition-transform duration-1000 transform-style-3d ${isPlayerFlipped ? 'rotate-y-180' : ''}`}
                  >
                    {/* Front Face */}
                    <div className="bg-black/70 backdrop-blur-lg rounded-3xl shadow-2xl p-6 flex flex-col items-center gap-4 text-center backface-hidden">
                      <img 
                        src={nowPlaying.now_playing.song.art} 
                        alt={nowPlaying.now_playing.song.album} 
                        className="w-56 h-56 rounded-2xl object-cover shadow-lg"
                      />
                      <div className="w-full overflow-hidden mt-2">
                        <p className="text-white text-xl font-bold truncate">{nowPlaying.now_playing.song.title}</p>
                        <p className="text-gray-300 text-base mt-1 truncate">{nowPlaying.now_playing.song.artist}</p>
                      </div>
                      <button 
                        onClick={togglePlayPause} 
                        className="w-16 h-16 mt-2 bg-white/20 text-white rounded-full flex items-center justify-center hover:bg-white/30 transition-all duration-300 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-white/50"
                        aria-label={isPlaying ? "Pause" : "Play"}
                      >
                        {isPlaying ? (
                          <svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8" fill="currentColor" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                        ) : (
                          <svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8 ml-1" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                        )}
                      </button>
                    </div>
                    {/* Back Face */}
                    <div className="absolute top-0 left-0 w-full h-full bg-black/70 backdrop-blur-lg rounded-3xl shadow-2xl p-6 flex flex-col items-center justify-center text-center backface-hidden [transform:rotateY(180deg)]">
                      <p className="text-gray-200 text-base leading-relaxed">
                        Music on radiomore.love is royalty-free and may be played publicly without licensing fees.
                      </p>
                    </div>
                  </div>
                </div>
              )}


              {isPopupOpen && (
                <div 
                    className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in"
                    onClick={() => setIsPopupOpen(false)}
                    role="dialog"
                    aria-modal="true"
                    aria-labelledby="popup-title"
                >
                    <div 
                        className={`bg-black/80 rounded-2xl shadow-2xl p-6 w-full m-4 text-white relative animate-scale-in flex flex-col ${popupTitle === 'Instagram' || popupTitle === 'X' || popupTitle === 'YouTube' ? 'max-w-lg' : 'max-w-md'}`}
                        onClick={(e) => e.stopPropagation()}
                    >
                        <button onClick={() => setIsPopupOpen(false)} className="absolute top-3 right-3 text-gray-400 hover:text-white transition-colors z-10" aria-label="Close popup">
                            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                        </button>
                        <h2 id="popup-title" className="font-bold mb-4" dangerouslySetInnerHTML={{ __html: popupIcon }}></h2>
                        
                        <div ref={popupContentRef} className="text-gray-300 space-y-3 max-h-[60vh] overflow-y-auto pr-2 overscroll-contain" dangerouslySetInnerHTML={{ __html: popupContent }}></div>
                    </div>
                </div>
              )}

              {showIosInstructions && (
                  <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in" onClick={() => setShowIosInstructions(false)}>
                      <div className="bg-black/80 backdrop-blur-sm text-white p-6 rounded-xl shadow-2xl text-center max-w-sm mx-4 animate-scale-in relative" onClick={(e) => e.stopPropagation()}>
                          <button onClick={() => setShowIosInstructions(false)} className="absolute top-2 right-2 text-gray-400 hover:text-white" aria-label="Close instructions">
                             <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" /></svg>
                          </button>
                          <h3 className="text-xl font-bold mb-3">Add to Home Screen</h3>
                          <p className="mb-4 text-gray-300">To install the app, please follow these steps:</p>
                          <div className="text-left space-y-3">
                             <p>1. Tap the <span className="font-bold">Share</span> icon in your browser's toolbar.</p>
                             <p>2. Scroll down and tap on <span className="font-bold">'Add to Home Screen'</span>.</p>
                          </div>
                      </div>
                  </div>
              )}

              {showGenericInstructions && (
                  <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in" onClick={() => setShowGenericInstructions(false)}>
                      <div className="bg-black/80 backdrop-blur-sm text-white p-6 rounded-xl shadow-2xl text-center max-w-sm mx-4 animate-scale-in relative" onClick={(e) => e.stopPropagation()}>
                          <button onClick={() => setShowGenericInstructions(false)} className="absolute top-2 right-2 text-gray-400 hover:text-white" aria-label="Close instructions">
                             <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" /></svg>
                          </button>
                          <h3 className="text-xl font-bold mb-3">Install App</h3>
                          <p className="mb-4 text-gray-300">To add this app to your home screen:</p>
                          <div className="text-left space-y-3">
                             <p>1. Open your browser's menu (usually <span className="font-bold">‚ãÆ</span> or <span className="font-bold">‚ò∞</span>).</p>
                             <p>2. Look for and tap on the <span className="font-bold">'Install app'</span> or <span className="font-bold">'Add to Home Screen'</span> option.</p>
                          </div>
                      </div>
                  </div>
              )}

              <div className="absolute bottom-4 right-4 z-40">
                <elevenlabs-convai agent-id="agent_01jzk1yswsenmr9h8h60ybk8xf"></elevenlabs-convai>
              </div>
            </div>
            
            {showOnboarding && onboardingStep > 0 && (
                <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-[60] animate-fade-in" onClick={(e) => { e.stopPropagation(); handleNextOnboardingStep(); }}>
                    <div
                        className={`absolute border-4 border-dashed border-white pointer-events-none ${onboardingTransitionClass} ${isOnboardingStepFading ? 'opacity-0' : 'opacity-100'}`}
                        style={onboardingSteps[onboardingStep].highlightStyle}
                    ></div>
                    <div
                        className={`absolute bg-black/80 text-white p-5 rounded-lg shadow-2xl w-[calc(100%-2rem)] max-w-xs ${onboardingTransitionClass} ${isOnboardingStepFading ? 'opacity-0' : 'opacity-100'}`}
                        style={onboardingSteps[onboardingStep].tooltipStyle}
                        onClick={(e) => e.stopPropagation()}
                    >
                        <p className="text-lg font-bold mb-2">{onboardingSteps[onboardingStep].title}</p>
                        <p className="text-sm text-gray-300 mb-4">{onboardingSteps[onboardingStep].text}</p>
                        <div className="flex justify-between items-center">
                            <button onClick={handleSkipOnboarding} className="text-gray-400 hover:text-white text-sm transition-colors">Skip</button>
                            <div className="text-sm text-gray-500">{onboardingStep}/3</div>
                            <button onClick={handleNextOnboardingStep} className="bg-white hover:bg-gray-200 text-black font-bold py-2 px-4 rounded-lg text-sm transition-colors">
                                {onboardingStep === 3 ? 'Finish' : 'Next'}
                            </button>
                        </div>
                    </div>
                </div>
            )}

            {isMounted && (
              <div className={`fixed bottom-0 left-0 right-0 bg-black/80 backdrop-blur-sm text-white z-50 shadow-lg h-[80px] flex items-center transition-transform duration-500 ease-in-out ${showInstallPrompt ? 'translate-y-0' : 'translate-y-full'}`}>
                  <div className="container mx-auto flex items-center justify-between gap-3 px-4">
                      <img src={logoUrl} alt="App Logo" className="w-12 h-12 rounded-lg hidden sm:block flex-shrink-0" />
                      <div className="flex-grow">
                          <p className="font-bold text-sm sm:text-base">Get the Full App Experience</p>
                          <p className="text-xs sm:text-sm text-gray-300">Add radiomore.love to your home screen.</p>
                      </div>
                      <div className="flex items-center gap-2 flex-shrink-0">
                          <button onClick={handleInstallClick} className="bg-white hover:bg-gray-200 text-black font-bold py-2 px-4 rounded-lg transition-colors text-sm">
                              Install
                          </button>
                          <button onClick={handleDismissInstall} className="text-gray-400 hover:text-white p-2 rounded-full" aria-label="Dismiss">
                              <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" /></svg>
                          </button>
                      </div>
                  </div>
              </div>
            )}
          </React.Fragment>
        );
      };

      const rootElement = document.getElementById('root');
      if (!rootElement) {
        throw new Error("Could not find root element to mount to");
      }

      const root = ReactDOM.createRoot(rootElement);
      root.render(
        <React.StrictMode>
          <App />
        </React.StrictMode>
      );
    </script>
    <script src="https://unpkg.com/@elevenlabs/convai-widget-embed" async type="text/javascript"></script>
    <style>
        .rotate-y-180 {
            transform: rotateY(180deg);
        }
        
        @keyframes fade-in-up {
            from {
                opacity: 0;
                transform: translate(-50%, calc(-50% + 20px));
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
        }
        .fixed.top-1\/2.left-1\/2.-translate-x-1\/2.-translate-y-1\/2.animate-fade-in-up {
            /* Let the perspective container handle the positioning */
        }

        @keyframes marquee {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        .animate-marquee {
            animation: marquee 60s linear infinite;
        }

        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .animate-fade-in {
            animation: fade-in 0.3s ease-out forwards;
        }

        @keyframes scale-in {
            from { 
                opacity: 0;
                transform: scale(0.95);
            }
            to { 
                opacity: 1;
                transform: scale(1);
            }
        }
        .animate-scale-in {
            animation: scale-in 0.3s ease-out forwards;
        }
        
        @keyframes fade-in-long {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .animate-fade-in-long {
            animation: fade-in-long 1.5s ease-in-out forwards;
        }

        @keyframes fade-out-long {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        .animate-fade-out-long {
            animation: fade-out-long 1.5s ease-in-out forwards;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .logo-spinning {
            animation: spin 8s linear infinite;
        }
        
        /* Cross-browser compatibility styles */
        .backdrop-blur-sm {
            -webkit-backdrop-filter: blur(4px);
        }
        .backdrop-blur-lg {
            -webkit-backdrop-filter: blur(16px);
        }
        .transform-style-3d {
            transform-style: preserve-3d;
            -webkit-transform-style: preserve-3d;
        }
        .backface-hidden {
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }
        .ticker-mask {
            -webkit-mask-image: linear-gradient(to right, black 90%, transparent 100%);
            mask-image: linear-gradient(to right, black 90%, transparent 100%);
        }

        /* Fix for 100vh on mobile browsers */
        .h-screen-dynamic {
            height: 100vh; /* Fallback */
            height: calc(var(--vh, 1vh) * 100);
        }

        /* Improve touch responsiveness on interactive elements */
        button, a, [role="button"] {
            touch-action: manipulation;
        }
    </style>
  </body>
</html>
